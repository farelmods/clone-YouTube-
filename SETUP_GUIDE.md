# Panduan Pengaturan Playtube

Ikuti langkah-langkah di bawah ini untuk menghubungkan aplikasi Playtube dengan layanan pihak ketiga.

## 1. Menghubungkan ke Supabase (Google Auth & Database)

1.  Buka [Supabase Dashboard](https://app.supabase.com/).
2.  Buat proyek baru.
3.  Pergi ke **Project Settings** > **API**.
4.  Salin `Project URL` dan `anon public key`.
5.  Buka file `.env` di root folder proyek ini.
6.  Tambahkan atau ganti nilai berikut:
    ```env
    SUPABASE_URL=https://your-project.supabase.co
    SUPABASE_ANON_KEY=your-anon-key
    ```
7.  Untuk Google Login:
    -   Pergi ke **Authentication** > **Providers** > **Google**.
    -   Aktifkan (Enable) Google Provider.
    -   Masukkan `Client ID` dan `Client Secret` dari Google Cloud Console.
    -   Tambahkan URL redirect yang disediakan Supabase ke Google Cloud Console (biasanya `https://<project-id>.supabase.co/auth/v1/callback`).

### Konfigurasi Database

Agar fitur **Subscriptions, Riwayat, Like, dan Video Anda (Upload)** berfungsi secara nyata, jalankan SQL berikut di **SQL Editor** Supabase Anda:

```sql
-- Tabel untuk Subscription
CREATE TABLE subscriptions (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  channel_id TEXT NOT NULL,
  channel_name TEXT NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  UNIQUE(user_id, channel_id)
);

-- Tabel untuk Riwayat Tontonan
CREATE TABLE history (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  video_id TEXT NOT NULL,
  video_data JSONB NOT NULL,
  viewed_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);

-- Tabel untuk Likes/Dislikes
CREATE TABLE likes (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  video_id TEXT NOT NULL,
  type TEXT CHECK (type IN ('like', 'dislike')),
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  UNIQUE(user_id, video_id)
);

-- Tabel untuk Simpan Video (Watch Later)
CREATE TABLE saved_videos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  video_id TEXT NOT NULL,
  video_data JSONB NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL,
  UNIQUE(user_id, video_id)
);

-- Tabel untuk Video yang diupload user
CREATE TABLE user_videos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  title TEXT NOT NULL,
  description TEXT,
  video_url TEXT NOT NULL,
  thumbnail TEXT,
  views TEXT DEFAULT '0',
  time TEXT DEFAULT 'Baru saja',
  created_at TIMESTAMP WITH TIME ZONE DEFAULT TIMEZONE('utc'::text, NOW()) NOT NULL
);

-- Aktifkan RLS (Row Level Security)
ALTER TABLE subscriptions ENABLE ROW LEVEL SECURITY;
ALTER TABLE history ENABLE ROW LEVEL SECURITY;
ALTER TABLE likes ENABLE ROW LEVEL SECURITY;
ALTER TABLE saved_videos ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_videos ENABLE ROW LEVEL SECURITY;

-- Buat Policy sederhana (User hanya bisa akses data mereka sendiri)
CREATE POLICY "Users can manage their own subscriptions" ON subscriptions FOR ALL USING (auth.uid() = user_id);
CREATE POLICY "Users can manage their own history" ON history FOR ALL USING (auth.uid() = user_id);
CREATE POLICY "Users can manage their own likes" ON likes FOR ALL USING (auth.uid() = user_id);
CREATE POLICY "Users can manage their own saved videos" ON saved_videos FOR ALL USING (auth.uid() = user_id);
CREATE POLICY "Users can manage their own uploads" ON user_videos FOR ALL USING (auth.uid() = user_id);
```

## 2. Menghubungkan ke YouTube API (Pencarian & Komentar)

**Catatan Penting:** Aplikasi ini sekarang secara eksklusif menggunakan data asli dari YouTube API. Jika API Key tidak diatur, video tidak akan muncul (tidak ada lagi simulasi/mock data).

1.  Buka [Google Cloud Console](https://console.cloud.google.com/).
2.  Buat proyek baru atau pilih proyek yang sudah ada.
3.  Cari dan aktifkan **YouTube Data API v3**.
4.  Pergi ke **Credentials** > **Create Credentials** > **API Key**.
5.  Salin API Key tersebut.
6.  Buka file `.env` di root folder proyek ini.
7.  Ganti nilai `YOUTUBE_API_KEY` dengan API Key Anda.

## 3. Fitur Upload Video

Fitur upload pada aplikasi ini menyimpan video secara lokal di folder `public/uploads/` dan menyimpan metadatanya di database Supabase Anda. Hal ini membuat fitur upload menjadi nyata dan persisten bagi setiap pengguna.

## 4. Cara Menjalankan

1.  Pastikan Node.js sudah terinstall.
2.  Jalankan `npm install`.
3.  Jalankan `npm start` atau `node server.js`.
4.  Buka `http://localhost:3000` di browser Anda.

---
Dibuat dengan ❤️ untuk komunitas Playtube.
